<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat</title>
</head>
<body>
{% if chats %}
{% for chat in chats %}
{% if chat.author == username %}
<div style="color: aqua;">
    {{ chat.content }}
</div>
{% else %}
<div style="color: blue;">
    {{ chat.content }}
</div>
{% endif %}
{% endfor %}
{% endif %}
<center>
    <form action="{% url 'chatroom' 'room' 'username' %}" method="post">
        {% csrf_token %}
        <input type="text" placeholder="chat" name="chat" required>
        <input type="hidden" value="{{ room }}" name="room_name">
        <button type="submit">Send</button>
    </form>
</center>

<script>
    // Determine the WebSocket protocol based on the application's URL
    const websocketProtocol = window.location.protocol === "https:" ? "wss" : "ws";
    const wsEndpoint = `${websocketProtocol}://${window.location.host}/ws/notification/{{room_name}}/`;

    // Create a new WebSocket connection
    const socket = new WebSocket(wsEndpoint);

    // Successful connection event
    socket.onopen = (event) => {
        console.log("WebSocket connection opened!");
    };

    // Socket disconnect event
    socket.onclose = (event) => {
        console.log("WebSocket connection closed!");
    };
</script>

</body>
</html>
